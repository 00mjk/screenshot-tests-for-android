apply plugin: 'groovy'
apply plugin: 'maven'

dependencies {
    compile gradleApi()
}
repositories {
    mavenCentral()
}

group='com.facebook.testing.screenshot'
version='0.1-SNAPSHOT'

def generatedOutputDir = file('build/generated-resources')
def generatedZip = generatedOutputDir.toString() + '/android_screenshot_test.zip'

task generatePyZip(type: Exec) {
     outputs.dir generatedOutputDir
     commandLine 'zip', '-r', generatedZip, 'src/py/android_screenshot_tests'

     doFirst {
        println "Creating directory for resources"
        generatedOutputDir.mkdirs()
     }
}

uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: uri('../repo'))
        }
    }
}

compileJava {
    sourceSets {
      main {
         // I have no idea what I'm doing
         output.dir(generatedOutputDir, builtBy: 'generatePyZip')
         resources.srcDirs generatedOutputDir
      }
    }
}